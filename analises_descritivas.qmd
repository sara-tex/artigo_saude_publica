---
title: "analises_psi"
format: html
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(janitor)
```

```{r}
df <- read_csv("dados-limpo.csv") |> 
  as_tibble()
```

```{r}
df |> 
  count(nivel_atencao) |> 
  mutate(
    prop = n/sum(n) * 100
  )
```

Conforme tabela X, Os estabelecimentos indicados no banco de dados foram classificados como assistenciais, logísticos e de apoio, a partir da portaria XXXX que define XXXX.Foram mantidos apenas os casos pertinentes aos níveis assistenciais (primário, secundário e terciária), tendo sido retirados estabelecimentos ligados a sistemas de apoio (n = 794) e logísticos (n = 1462). 

```{r}
# Filtrar apenas níveis assistenciais
df <- df |> 
  clean_names() |> 
  filter(
    nivel_atencao %in% c("atenção primária", "atenção secundária", "atenção terciária") 
  ) |> 
  select(
    -1
  ) 
```


```{r}
# quantidade vínculos de psicólogos por nível assistencial no Brasil
df |> 
  count(nivel_atencao) |> 
  mutate(
    prop = n / sum(n) * 100
  )
```

```{r}
df |> 
  count(nivel_atencao, estabelecimento, sort = T) |> 
  mutate(
    prop = n/sum(n)*100
  ) |>
  arrange(nivel_atencao) 
```

```{r}
# quantidade de vínculos de psicólogos por nível assistencial em cada região
df |> 
  count(nivel_atencao, regiao) |> 
  group_by(regiao) |> 
  mutate(
    prop = n / sum(n) * 100
  ) |> 
  ungroup() 
```

```{r}
# quantidade de vículos de psicólogos por gênero
df |> 
  count(genero) |> 
  mutate(
    prop = n / sum(n) * 100
  ) 
```

```{r}
# quantidade de vículos de psicólogos por gênero em cada nível assistencial
df |> 
  count(genero, nivel_atencao) |>
  group_by(nivel_atencao) |> 
  mutate(
    prop = n / sum(n) * 100
  ) |> 
  ungroup()
```

```{r}
# sem repetição de psicólogos
psi_uni <- df |> 
  distinct(codigo_profissional_saude,.keep_all = T) 
```

```{r}
# quantidade de psicólogos sem repetição de acordo com o gênero
psi_uni |>
  drop_na(genero) |> 
  count(genero) |> 
  mutate(
    prop = n / sum(n)
  )
```

```{r}
df |> 
  filter(nivel_atencao != "aguardando categorização") |> 
  drop_na(genero) |> 
  count(nivel_atencao, genero) |> 
  mutate(
    prop = n / sum(n),
    .by = nivel_atencao
  ) |> 
  ggplot(
    aes(prop, nivel_atencao, fill = genero)
  )+
  geom_col()
```

```{r}
df |> 
  filter(nivel_atencao != "aguardando categorização") |> 
  count(estado, nivel_atencao) |> 
  mutate(
    prop = n / sum(n),
    .by = estado
  ) 
```

```{r}
df |> 
  filter(nivel_atencao != "aguardando categorização") |> 
  count(nivel_atencao) |> 
  mutate(
    prop = n / sum(n)
  )
```

```{r}
df |> 
  filter(nivel_atencao != "aguardando categorização") |>
  count(regiao, nivel_atencao) |> 
  mutate(
    prop = n / sum(n),
    .by = regiao
  )
```