---
title: "analises_inferenciais"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(ggrepel)
library(rstatix)
library(summarytools)
```

```{r}
df <- read_csv("dados-limpo.csv") |> 
  filter(nivel_atencao %in% c("atenção primária", "atenção secundária", "atenção terciária"))
```

```{r}
df |> 
  count(genero) |> 
  mutate(
    prop = n / sum(n) * 100
  ) 

#ver diferença de gênero geral (teste T)
```

```{r}
# quantidade de psicólogos em cada região por nível de atenção
df |> 
  count(regiao, nivel_atencao) |> 
  pivot_wider(names_from = nivel_atencao, values_from = n, id_cols = regiao) 
```

```{r}
# tabela de contingência e teste de qui-quadrado da quantidade de vínculos em cada região por nível de atenção
ctable(x = df$regiao, y = df$nivel_atencao, chisq = T)
```

```{r}
#variável de proporção: "nº de habitantes por profissional de psicologia"
 
df_prop <- df |>
  group_by(nome_do_municipio, regiao, estado) |> 
  summarise(
    populacao_muni = first(populacao_muni), 
    # n() agora contará corretamente centenas ou milhares de linhas para SP
    quanti_psis_muni = n(), 
    prop_psi_muni =  populacao_muni/quanti_psis_muni,
    .groups = 'drop'
  ) |>
  ungroup()

## fazer a análise por estado
```

```{r}

# verificando pressuposto da proporção 

df_prop |>
  group_by(regiao) |>
  shapiro_test(prop_psi_muni)

levene_test(prop_psi_muni ~ regiao, data = df_prop)

## aqui deu erro, porque a amostra é muito grande

df_prop |>
  group_by(estado) |>
  shapiro_test(prop_psi_muni)

levene_test(prop_psi_muni ~ estado, data = df_prop)
```

```{r}

#anova entre regiões (proporção por região)

##-> os pressupostos não foram acatados. precisa refazer anova

modelo_regiao <- aov(prop_psi_muni ~ regiao, data = df_prop)

summary(modelo_regiao)

TukeyHSD(modelo_regiao)

```

```{r}
#anova entre regiões (proporção por região)

##-> os pressupostos não foram acatados. precisa refazer anova

modelo_regiao <- aov(prop_psi_muni ~ regiao, data = df_prop)

summary(modelo_regiao)

TukeyHSD(modelo_regiao)
```

centro-oeste tem menos psicólos por população do que o sudeste proporcionalmente
nordeste tem mais psicólogos por população que o norte
nordeste tem menos psicólogos por pop do que o sudeste
nordeste tem menos psicólogos por pop do que o sul
norte tem menos psicólogos por pop do que o sudeste

norte tem menos psicólogos por pop do que o sul
e o sudeste tem menos psicólogos por população do que o sul

#verificar a prevalência de psicólogos por nível de atenção em cada região (ex.: nordeste tem mais psicólogos na atenção primária que sudeste?)

```{r}
#anova entre estados

modelo_estado <- aov(prop_psi_muni ~ estado, data = df_prop)

summary(modelo_estado)

TukeyHSD(modelo_estado)
  
```

```{r}
#correlação entre população e nº de vínculos

## --> que função usar pra verificar os pressupostos?

cor.test(df_prop$populacao_muni, df_prop$prop_psi_muni, method = "pearson")

```

```{r}
library(ggplot2)

ggplot(df_prop, aes(x = populacao_muni, y = prop_psi_muni)) +
  geom_point(alpha = 0.6, color = "black") +
  geom_smooth(method = "lm", se = FALSE, color = "gray") + 
  geom_text_repel(
    data = df_prop |> slice_max(populacao_muni, n = 5),
    aes(label = nome_do_municipio), 
    size = 3, 
    box.padding = 0.5, 
    point.padding = 0.5,
    color = "black",
    max.overlaps = Inf) +labs(
    title = "Correlação entre População e Psicólogos",
    x = "População do Município",
    y = "Proporção de Psicólogos"
  ) +
  theme_minimal()
```


